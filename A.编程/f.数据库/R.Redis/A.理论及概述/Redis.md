# 1. 数据结构与对象

## 1.1 简单动态字符串

### 1.1.0  概述

简单动态字符串（Simple  dynamic  string  ，SDS） ，SDS用作redis的默认字符串表示



### 1.1.1 作用：

- 保存数据库中的字符串值
- SDS还被用作缓冲区（buffer）:AOF模块中AOF缓冲区，以及客户端状态中的输入缓冲区，都是由SDS实现的



### 1.1.2  SDS的定义

```c
struct sdshdr {

	//记录buf数组中已使用字节的数量,等于SDS所保存字符串的长度
	int len;

	//记录bug数组中未使用字节的数量
    int free;
    
    //字节数组，用于保存字符串
    char buf[];

}

```

SDS遵循C字符串以空字符串结尾的惯例，保存空字符的1字节空间不计算在SDS的len属性里面，

并且为空字符分配额外的1字节空间，以及添加空字符到字符串末尾等操作，都是由SDS函数自动完成的，所以这个空字符对于SDS的使用者来说是完全透明的。

遵循空字符结尾的好处：SDS可以直接重用一部分C字符串函数库里面的函数。

注意：SDS与C字符串不一样，不是空字符做为字符串的结束标志。



### 1.1.3 SDS的特点

- ​	记录自身长度：便于获取字符串长度

- ​    自动扩减容 : 添加字符串时，会判断能否存储，若不能存储 则进行扩容，并会预留一部分的空闲空间

- ​    删除快 : SDS进行删除时，只改变 len 与 free 的大小，并不实质性的修改空间里的值

-    二进制安全：SDS 以 len的大小做为长度表示，所以可以存储任意格式的字符，不像C字符串以空字符做

    ​                         为结束标志

-    兼容部分C字符串函数：遵循以空字符结尾的惯例，让SDS可以重用一部分\<string.h\> 库定义的函数



### 1.1.4 空间管理方案

​	SDS实现了空间预分配和惰性空间释放两种优化策略

- ​	空间预分配

       SDS扩容时会多分配一些空闲空间，以达到减少空间分配的次数

    ​	计算方式：

    ​		如果修改后，len 小于 1MB 时，将len扩充到足够使用的同时，并扩充与len相同大小的free

    ​        如果修改后，len大于等于 1MB，将len扩充到足够使用的同时,并扩充free到1MB

- ​    惰性空间释放

    ​	当SDS字符串需要缩短时，程序不立即操作空间进行缩短操作，而是操作 len 与 free达到缩短效果

    ​	与此同时，SDS也提供了相应的API，让我们可以在有需要时，真正释放SDS的未使用空间，避免操作

    ​    内存浪费









## 1.2 链表

### 1.2.0 概述





## 1.3 字典



## 1.4 跳跃表



## 1.5 压缩列表



## 1.6 对象



# 2.